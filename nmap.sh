#!/bin/bash

if [[ $@ < 1 ]]; then
    echo "usage: ./nmap.sh <ip>"
    exit 1
fi

ip=$1

ports=$(nmap -p- --min-rate=1000 -T4 $ip | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//)
nmap -A -p$ports $ip -oN ./nmap.txt
