# sqsh xp_cmdshell wrapper 
# Warning: each cmd creates a new connection execute with care
import os
import readline

username = ''
password = ''
ip = '127.0.0.1'
port = '1433'
executed = []

# "interactive" shell
while True:

    # save previous command
    try:
        readline.read_history_file(executed)
    except:
        pass

    # get command
    cmd = input('>').strip()
    executed.append(cmd)

    #execute command
    output = os.popen("sqsh -S {}:{} -U '{}' -P '{}' -C \"exec master..xp_cmdshell '{}'\"".format(ip, port, username, password, cmd)).read()

    # format output / strip empty lines
    output = output.split('\n')
    output = [line for line in output if line.strip()]
    print("\n".join(output))
    
